# Chapter 04. The Network Layer : Data Plane

네트워크 계층은 프로토콜 스택 중 가장 복잡한 계층이다. 서로 상호 작용하는 데이터 평면, 제어 평면 두 부분으로 나뉜다.

네트워크 계층 H1 - 네트워크 계층 H2 : How to interact
- H1의 트랜스포트 계층으로부터 세그먼트를 받아 각 세그먼트를 데이터 그램으로 캡슐화 -> 인접한 라우터에게 데이터 그램 전송
- 수신 호스트 H2의 네트워크 계층은 트랜스포트 계층 세그먼트를 추출해서 H2의 트랜스포트 계층으로 전달

네트워크 계층의 근본적 역할 : 송신 호스트에서 수신 호스트로 패킷 전달
이를 위해서 필요한 두가지
1. 포워딩(전달) : 라우터가 다음 라우터로 전달
2. 라우팅 : 패킷 경로 설정(It's done according to the routing algorithms.)

포워딩은 매우 짧은 시간 단위 따라서 하드웨어에서 실행됨. 라우팅은 송신-수신까지 데이터그램의 종단간 경로를 결정하는 것. 일반적으로 수분 정도. 그래서 소프트웨어에서
실행됨.
포워딩 테이블 : 라우터는 도착하는 패킷의 헤더 필드 값을 조사해서 패킷을 포워딩함
제어평면 : 라우팅 알고리즘(라우팅 프로세서 - 기존 CPU 에서 실행)
데이터 평면 : 로컬 포워딩 테이블

## 라우터 내부의 네가지 요소
1. 입력포트 : 포워딩 테이블을 참조해서 도착된 패킷이 스위칭 구조를 통해 전달되는 라우터 출력 포트를 결정함.
2. 스위칭 구조 : 라우터의 입력 포트와 출력 포트를 연결함
3. 출력 포트 : 스위칭 구조에서 수신한 패킷 저장, 필요한 링크 계층, 물리적 계층 기능 수행하여 출력 링크로 패킷 전송.
4. 라우팅 프로세서 : 라우터의 포워딩 테이블 계산.

## 패킷 큐
입력 포트, 출력 포트 모두에서 형성될 수 있다.
### 입력 큐잉
입력 큐는 무한정 길이로 증가하면, 중요한 패킷 손실이 늘어난다.

### 출력 큐잉
출력 포트의 패킷 스캐줄러가 대기중인 패킷 중에 선택하게 된다.

## 패킷 스케줄링
### FIFO
### 우선순위 큐잉
### 라운드 로빈

## 인터넷 프로토콜(IP)
### IPv4
IP 데이터 그램 = 20 byte 헤더 + TCP 헤더 = 20 byte ==> 40 byte in total