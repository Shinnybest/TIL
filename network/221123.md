# 네트워크 계층 : 제어평면
포워딩 테이블(목적지 기반 포워딩), 플로우 테이블(일반화된 포워딩)이 네트워크 계층의 데이터 평면과 제어 평면을 연결하는 주요 요소이다.

## 라우팅 알고리즘
송신~수신 라우터의 네트워크를 통과하는 최적의 경로를 결정하는 알고리즘
실제로는 여러가지 이유로 최적의 경로를 결정하지 못할 수 있다.(ex. A 기관은 B 기관이 소유한 네트워크가 보낸 패킷을 전달해서는 안된다.)

## 링크 상태 라우팅 알고리즘
중앙집중형 라우팅 알고리즘
네트워크 전체에 대한 완전한 정보를 가지고 출발지~목적지 사이의 최소 비용 경로 계산
라우터가 연결상태와 링크 비용을 모두 알고 있다.
다익스트라 알고리즘을 주로 사용한다.

### 다익스트라
node를 잇는 edge 가중치는 음수가 있으면 안 된다.

1. 방문하지 않은 정점 중 가장 가중치가 적은 정점을 방문한다.
2. 해당 정점을 거쳐서 갈 수 있는 정점의 거리가 이전에 기록한 값보다 작으면 그 거리를 갱신한다.

## 거리 벡터 라우팅 알고리즘
한 라우터가 모든 링크 비용에 대한 완전한 정보를 갖고 있지는 않다.
최소 비용 경로 계산은 각 라우터들에 의해 반복/분산된 방식으로 수행된다.
각 라우터는 본인에게 연결된 인접 노드에 대한 링크 비용 정보만 알고 있다.
벨만-포드 알고리즘을 주로 사용한다.
이웃끼리 반복해서 정보를 교환함으로써 최적의 경로를 갱신한다.

### 벨만 포드 알고리즘
다익스트라와 다른 점 : 가중치 음수여도 가능하다. 다만 시간이 더 오래 걸린다.
- 다익스트라 알고리즘 : 그리디 알고리즘
- 벨만 포드 알고리즘 : 다이나믹 프로그래밍(이전에 계산한 최단 경로를 이용해 새로운 최단 경로를 갱신한다.)

### count to infinity
- y ~ x : 6
- y ~ z : 1
- z ~ x : 7

### poisoned reverse

## 정적 라우팅 알고리즘, 동적 라우팅 알고리즘
경로 변경이 느리고 사람이 직접 링크에 대한 비용을 수정
네트워크 트래픽 부하, topology 변화에 따라서 라우터가 자체적으로 경로를 바꾼다. 
동적 알고리즘은 직접적으로 응답한다. 네트워크 변화에 더 빠르게 대응하나, 경로의 loop나 경로 진동과 같은 문제에 취약하다.

# 인터넷에서의 AS 내부 라우팅: OSPF
하나의 AS(Autonomous System) 안에서 동작하는 링크 상태 라우팅 프로토콜
계층 구조 동적 라우팅 프로토콜
다익스트라, SPF 알고리즘 사용한다.

### 장점
- 빠른 재수렴
    - 네트워크의 모든 라우터 간 정보를 주고 받는 시간 : 컨버전스 타임
    - 변화 생기면 바로 해당 정보 전파 → 변경된 라우팅 정보를 반영 → 빠른 컨버전스 타임
- 부분 갱신
    - 링크 상태 변화 시 라우팅 정보 전송 : 리소스 낭비
- Area 개념
    - 더 효율적인 관리 가능하다.
- Stub Area 개념
    - 외부 경로에 대한 정보 차단
    - 라우팅 테이블 크기 줄이고 안정성 확보

### OSPF 라우터의 종류
[위치에 따라서]
- IR : 특정 Area에 속함
- ABR  : 두개 이상의 Area에 속한 라우터
- ASBR : 외부 네트워크와 연결되는 라우터

[ID 와 역할에 따라서]
- 라우터 아이디
- DR(지정된 라우터) & BDR(백업 지정 라우터) : 라우터와 링크 상태를 교환할 경우 발생 트래픽을 줄이고 링크 상태의 싱크를 올바로 관리한다.

### 이웃
- down : 서로 정보 못 주고 받음
- init : 이웃 발견
- two-way : 양방향 통신
- exstart : 양 라우터 간 주종관계 성립
- exchange : 링크 상태 정보 요청 응답, 요청 잘 받았음을 확인하는 과정
- loading
- full : 완전한 이웃

### OSPF and 라우팅 테이블 - LSA
LSA : OSPF가 사용하는 패킷 형태의 라우팅 정보
같은 AREA에 있으면 같은 LSD 정보를 가진다.
경로코드 : 비용을 기준으로 최적의 라우팅 산정 BUT 우선 순위가 고려되어 최적의 경로를 산정하게 된다.

### HOW OSPF가 라우팅 테이블을 만들고 유지?
- hello 패킷을 주고 받아서 이웃, 인접이웃간의 관계 구성
- 라우팅 정보를 LSA라고 하는데 이것을 모든 DR, BDR에 전송한다.
- 그리고 DR에 LSA가 도착하면 BDR은 자신의 타이머를 가동해서 DR이 이 정보를 OSPF 라우터에 전달하는 것을 기다린다.
- 각 라우터들은 LSA를 LSD에 저장한다.
- LSA 교환 후, 다익스트라를 써서 각 목적지까지 최적 경로를 계산하고 라우팅 테이블에 다시 저장한다.
- 주기적으로 hello 패킷 전달해서 정상적으로 라우터가 동작하고 있음을 알린다.
- 만약 네트워크 상태가 변하면 위 과정을 반복해서 라우팅 테이블을 만든다.

# 인터넷 서비스 제공업자 간의 라우팅 : BGP
글로벌 네트워크 : AS(하나의 인터넷 회선 사업자가 가진 모든 라우터들의 그룹)끼리 상호 통신함으로 구성됨
이 AS 들끼리 라우팅 경로를 주고 받으며 통신을 가능하게 하는 프로토콜 : BGP

# 인터넷 제어 메시지 프로토콜(ICMP)
ICMP는 네트워크 컴퓨터 위에서 돌아가는 운영 체제 오류 메세지를 전송 받는데 주로 쓰이며, 인터넷 프로토콜의 주요 구성원 중 하나로 인터넷 프로토콜에 의존하여 작업을 수행한다.

- TCP/IP에서 IP 패킷을 처리할 때 발생되는 문제를 알리거나, 진단 등과 같이 IP 계층에서 필요한 기타 기능들을 수행하기 위해 사용되는 프로토콜이다.
- IP 계층에서 데이터 그램 전달 상의 오류가 생겼을 때, 그 문제를 송신측에게 보고하기 위한 일련의 메세지들
- 일반적으로 이 ICMP는 라우터로부터 발생한다.